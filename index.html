<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live Dashboard - Temperature & Humidity</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { font-family: Arial; margin: 0; background: #f4f4f4; }
header { background:#222; color:#fff; padding:10px; text-align:center; }
#deviceStatus {
  margin-top:5px;
  font-weight:bold;
  padding:6px 10px;
  display:inline-block;
  border-radius:6px;
}
.container { display:flex; padding:10px; flex-wrap:wrap; }
.table-container { flex:1; background:#fff; padding:10px; margin-right:10px; border-radius:5px; max-height:600px; overflow:auto; }
.chart-container { flex:2; background:#fff; padding:10px; border-radius:5px; }
table { width:100%; border-collapse:collapse; }
th, td { border:1px solid #ddd; padding:5px; text-align:center; }
th { background:#222; color:#fff; }
.alerts { background:#fff; margin:10px; padding:10px; border-radius:5px; }
.alert-item { color:red; font-weight:bold; }
</style>
</head>

<body>

<header>
  <h3>ðŸŒ¡ Live Temperature & ðŸ’§ Humidity Dashboard</h3>
  <div id="deviceStatus">Checking device status...</div>
</header>

<div class="container">
  <div class="table-container">
    <h3>Latest Readings</h3>
    <table id="dataTable">
      <thead>
        <tr><th>Time</th><th>Temp (Â°C)</th><th>Humidity (%)</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="chart-container">
    <canvas id="myChart"></canvas>
  </div>
</div>

<div class="alerts">
  <strong>Alerts & Logs:</strong>
  <div id="alertContent"></div>
</div>

<script>
const sheetURL = "https://opensheet.elk.sh/1Om7C4niF3p1A9dEc_8I7xWJtTlsbK0p-54gS5PKzEHM/Sheet1";
let myChart = null;

function loadData() {
  fetch(sheetURL)
    .then(res => res.json())
    .then(data => {

      if (!data || data.length === 0) return;

      // ===== TABLE =====
      const tbody = document.querySelector("#dataTable tbody");
      tbody.innerHTML = "";
      const last10 = data.slice(-10);

      last10.forEach(r => {
        tbody.innerHTML += `
          <tr>
            <td>${r["Time Stamp"]}</td>
            <td>${r["Temperature "]}</td>
            <td>${r["Humidity "]}</td>
          </tr>`;
      });

      // ===== CHART =====
      const labels = data.map(r => r["Time Stamp"]);
      const temp = data.map(r => Number(r["Temperature "]));
      const hum = data.map(r => Number(r["Humidity "]));

      const ctx = document.getElementById("myChart").getContext("2d");
      if (myChart) myChart.destroy();

      myChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [
            { label:"Temperature (Â°C)", data:temp, borderColor:"red", borderWidth:2 },
            { label:"Humidity (%)", data:hum, borderColor:"blue", borderWidth:2 }
          ]
        },
        options:{ responsive:true, animation:false }
      });

      // ===== ALERTS =====
      const alertDiv = document.getElementById("alertContent");
      alertDiv.innerHTML = "";
      last10.forEach(r => {
        if (Number(r["Temperature "]) > 30)
          alertDiv.innerHTML += `ðŸ”¥ High Temp ${r["Temperature "]}Â°C at ${r["Time Stamp"]}<br>`;
        if (Number(r["Humidity "]) < 35)
          alertDiv.innerHTML += `âš  Low Humidity ${r["Humidity "]}% at ${r["Time Stamp"]}<br>`;
      });

      // ===== DEVICE STATUS =====
      const status = document.getElementById("deviceStatus");
      const lastRow = data[data.length - 1];
      const lastTime = new Date(lastRow["Time Stamp"]);
      const now = new Date();
      const diff = (now - lastTime) / 1000;

      if (diff <= 30) {
        status.innerHTML = "ðŸŸ¢ ESP8266 ONLINE";
        status.style.background = "green";
        status.style.color = "white";
      } else {
        status.innerHTML = "ðŸ”´ ESP8266 OFFLINE";
        status.style.background = "red";
        status.style.color = "white";
      }
    })
    .catch(err => console.error(err));
}

loadData();
setInterval(loadData, 10000);
</script>

<center><h2>Developed by Musab Jan</h2></center>

</body>
</html>

